## 现状结论
- 公共社区/校内共学社区目前“评论”只有 `comments_count` 计数，没有真实评论模型与接口，前端也没有帖子详情页与评论列表，因此做不了“像论坛一样开楼”。
- “发出却看不到/根本看不到”主要风险点有两类：
  - 发布后只做本地更新/刷新不稳定（网络失败、权限失败、分页/筛选导致新帖被隐藏）。
  - 列表渲染被动画容器影响（子项初始 opacity=0，in-view 判定未触发时会一直不可见）。

## 目标
- 公共社区与校内共学社区：发帖成功后必须立即可见，刷新后仍可见；发布失败要有明确原因与重试。
- 每条帖子支持进入“帖子详情”页，像论坛一样展示楼层评论：可发评论、可分页、评论会累计到计数。
- 交互与 UI 参考问答详情页的“回答列表 + 输入框”模式（不要求字段/结算完全一致）。

## 后端改造
### 1) 新增评论数据模型
- 新增 `CommunityComment`：`id, post_id, author_id, content, created_at, likes_count`（先做平铺楼层，不做楼中楼；后续可加 parent_id）。
- 新增 `CampusPostComment`：同结构，挂在 `CampusPost` 下。
- `comments_count`：创建评论时原子性 +1（或每次读时聚合计算；优先 +1 以保持性能与一致性）。

### 2) 补齐帖子详情与评论接口
- 公共社区：
  - `GET /api/v1/content/community/posts/{post_id}`（详情）
  - `GET /api/v1/content/community/posts/{post_id}/comments?skip&limit`（楼层列表）
  - `POST /api/v1/content/community/posts/{post_id}/comments`（发评论）
- 校内共学社区：
  - `GET /api/v1/content/campus/{school_id}/posts/{post_id}`
  - `GET /api/v1/content/campus/{school_id}/posts/{post_id}/comments?skip&limit`
  - `POST /api/v1/content/campus/{school_id}/posts/{post_id}/comments`
- 权限：校内评论沿用现有 `_can_access_campus_posts`；公共社区评论只要求登录。
- 兼容：保留现有帖子列表响应结构，新增详情/评论接口不破坏旧页面。

### 3) 稳定性兜底
- 对 tags/topic_ids 的 JSON 字符串解析做容错（避免脏数据导致 500）。

## 前端改造
### 1) 发帖可靠性与可见性
- 发布按钮：提交中禁用 + 明确错误提示（401/403/500 区分文案）。
- 发布成功：以“后端回源 re-fetch”为准更新列表；失败时提示“已发布但刷新失败”并提供手动刷新。
- 避免筛选误隐藏：新帖的 tags/topic_ids 与当前筛选条件一致（或发布后自动切换到“推荐/全部”）。

### 2) 帖子详情页（楼层）
- 新增页面：
  - `/community/posts/[id]`（公共社区帖子楼层）
  - `/campus/community/posts/[id]`（校内帖子楼层，依赖当前 schoolId）
- 页面结构（参考 QA 详情页）：
  - 顶部展示原帖（作者、时间、内容、标签/话题）
  - 楼层列表：按时间倒序或正序（建议正序更像“开楼”），支持分页加载
  - 底部输入框：发评论后自动插入并刷新计数
- 社区列表卡片：点击评论按钮或整卡进入详情页。

### 3) 列表“看不到”的动画修复
- 对社区列表的动画容器做修复：保证首屏与刷新后的列表项不因 in-view 判定失效而透明不可见。
  - 方案 A（推荐）：列表使用 `animate="visible"` 而非 `whileInView`，首屏必显。
  - 方案 B：补齐父容器 `hidden` variant 并放宽 viewport 判定。

## Playwright 验证（只测本次改动）
- 公共社区：发帖 -> 列表可见 -> 进入详情 -> 发评论 -> 评论出现且计数变化。
- 校内社区：发帖 -> 列表可见 -> 进入详情 -> 发评论 -> 评论出现且计数变化。

## 交付物（文件范围）
- 后端：`backend/app/models/content.py`、`backend/app/schemas/content.py`、`backend/app/api/v1/endpoints/content.py`（新增评论模型与接口）
- 前端：`frontend/app/community/page.tsx`、`frontend/app/campus/community/page.tsx`、新增帖子详情页目录、动画容器组件或替换用法
- E2E：新增 1-2 个社区评论相关用例
